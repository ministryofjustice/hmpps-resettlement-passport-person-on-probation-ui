{% extends "../partials/layout.njk" %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% set pageTitle = "To-do list" + titleHeading %}

{% block beforeContent %}
  {% set activePage = 'todo' %}
  {% include "../partials/subnavigation.njk" %}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row govuk-!-margin-bottom-4">
    <div class="govuk-grid-column-two-thirds">
      {% if validationResult.errors | length > 0 %}
        {{
          govukErrorSummary({
            titleText: t('generic-error-summary'),
            errorList: validationResult.errors
          })
        }}
      {% endif %}

      {% if action === 'Edit' %}
        {% set submitUrl = '/todo/item/' + editItem.id + '/edit' %}
      {% else %}
        {% set submitUrl = '/todo/add' %}
      {% endif %}
      <form action="{{ submitUrl }}" method="POST" class="govuk-form-group">
        <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
        <fieldset class="govuk-fieldset">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
            <h1 class="govuk-fieldset__heading">{{ action }} a to-do list item</h1>
          </legend>

          {{
            govukInput({
              inputmode: "text",
              label: {
                text: 'Title'
              },
              errorMessage: {
                text: validationResult.title
              } if validationResult.title,
              classes: "govuk-input--width-20",
              name: "title",
              id: "title",
              value: editItem.title
            })
          }}

          <div class="govuk-form-group">
            <label class="govuk-label" for="notes">Notes (optional)</label>
            <textarea class="govuk-textarea govuk-!-width-two-thirds" id="notes" name="notes" rows="5">
{{ editItem.notes }}</textarea
            >
          </div>

          {% if editItem.dueDate %}
            {% set dueDateDay = editItem.dueDate | dayOfMonth %}
            {% set dueDateMonth = editItem.dueDate | monthOfYear %}
            {% set dueDateYear = editItem.dueDate | yearOf %}
          {% endif %}

          {{
            govukDateInput({
                id: "due-date",
                namePrefix: "date",
              errorMessage: {
                text: validationResult.dueDate
              } if validationResult.dueDate,
                fieldset: {
                    legend: {
                        text: "Due date (optional)",
                        classes: "govuk-fieldset__legend--m"
                    }
                },
                hint: {
                    text: "For example, 31 03 2025"
                },
                items: [
                  {
                    name: 'day',
                    value: dueDateDay
                  },
                  {
                    name: 'month',
                    value: dueDateMonth
                  },
                  {
                    name: 'year',
                    value: dueDateYear
                  }
                ] if editItem.dueDate
            })
          }}
          <div class="govuk-form-group">
            {{
              govukButton({
                  type: submit,
                  text: action + " task",
                  preventDoubleClick: true
              })
            }}
          </div>
        </fieldset>
      </form>
    </div>
  </div>
{% endblock %}
